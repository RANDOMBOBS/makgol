<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.org.makgol.common.jwt.repository.RefreshTokenRepository">

    <select id="findTokenByEmail" resultType="com.org.makgol.common.jwt.vo.TokenResponseVo" parameterType="String">
        SELECT * FROM users WHERE email = #{email}
    </select>

    <insert id="saveToken" parameterType="Map">
        INSERT INTO refresh_token (token, email, expired, revoked, date)
        VALUES (#{token}, #{email}, #{expired}, #{revoked}, now())
    </insert>

    <select id="saveTokenUpdateRevoked" parameterType="String">
        UPDATE refresh_token SET revoked = true WHERE email = #{email} AND (expired = false OR revoked = false)
    </select>

    <select id="saveTokenUpdateExpried" parameterType="String">
        UPDATE refresh_token SET expired = true WHERE email = #{email} AND (expired = false OR revoked = false)
    </select>

</mapper>